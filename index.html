<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Redirecionando para o WhatsApp...</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17876134901"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'AW-17876134901');
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 100px 20px;
      background-color: #f0f0f0;
      color: #222;
    }
    h1 { color: #1a7f37; }
    .small { margin-top: 18px; font-size: 14px; color: #666; }
  </style>
</head>

<body>
  <h1>Você está sendo direcionado para o WhatsApp do grameiro.</h1>
  <p>Por favor, aguarde alguns segundos...</p>
  <p class="small" id="track"></p>

  <script>
    // 1) Captura parâmetros que vêm do Carrd/Google Ads
    const params = new URLSearchParams(window.location.search);

    // Se o Carrd não passar nenhum, ele tenta achar no localStorage (fallback)
    const gclid  = params.get('gclid')  || localStorage.getItem('gclid')  || '';
    const wbraid = params.get('wbraid') || localStorage.getItem('wbraid') || '';
    const gbraid = params.get('gbraid') || localStorage.getItem('gbraid') || '';

    // 2) Salva no localStorage para manter rastreio se tiver redirecionamento interno
    if (params.get('gclid'))  localStorage.setItem('gclid', params.get('gclid'));
    if (params.get('wbraid')) localStorage.setItem('wbraid', params.get('wbraid'));
    if (params.get('gbraid')) localStorage.setItem('gbraid', params.get('gbraid'));

    // 3) Mostra rastreio na tela (debug)
    document.getElementById("track").innerText =
      `Rastreio: gclid=${gclid || '-'} | wbraid=${wbraid || '-'} | gbraid=${gbraid || '-'}`;

    // 4) Dispara conversão no Google Ads (clique no WhatsApp)
    gtag('event', 'conversion', {
      'send_to': 'AW-17876134901/kEX7COuHweMbEPXXgMxC'
    });

    // 5) Monta URL final do WhatsApp
    const whatsappBase =
      "https://wa.me/553798332874?text=" +
      encodeURIComponent("Olá gostaria de um orçamento de grama.");

    // 6) Cola rastreio na URL do WhatsApp (IMPORTANTE)
    // (nem sempre o WhatsApp mantém isso, mas é o melhor método disponível)
    const tracking = [];
    if (gclid) tracking.push("gclid=" + encodeURIComponent(gclid));
    if (wbraid) tracking.push("wbraid=" + encodeURIComponent(wbraid));
    if (gbraid) tracking.push("gbraid=" + encodeURIComponent(gbraid));

    const finalUrl = tracking.length ? whatsappBase + "&" + tracking.join("&") : whatsappBase;

    // 7) Redireciona
    setTimeout(() => {
      window.location.href = finalUrl;
    }, 1200);
  </script>
</body>
</html>
